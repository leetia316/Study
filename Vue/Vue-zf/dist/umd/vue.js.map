{"version":3,"file":"vue.js","sources":["../../src/observer/array.js","../../src/utils.js","../../src/observer/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["// 获取数组原型上的方法\r\nlet oldArrayProtoMethods = Array.prototype\r\n\r\n// 继承方法\r\nexport let arrayMethods = Object.create(oldArrayProtoMethods)\r\n\r\nlet methods = [\r\n  'push',\r\n  'pop',\r\n  'shift',\r\n  'unshift',\r\n  'reverse',\r\n  'sort',\r\n  'split'\r\n]\r\n\r\nmethods.forEach(methods => {\r\n  arrayMethods[methods] = function (...args) {\r\n    console.log('数组方法被调用了')\r\n    const result = oldArrayProtoMethods[methods].apply(this, args)\r\n    let inserted\r\n    let ob = this.__ob__\r\n\r\n    switch (methods) {\r\n    case 'push':\r\n    case 'unshift':\r\n      inserted = args\r\n      break\r\n    case 'slice':\r\n      inserted = args.slice(2)\r\n      break\r\n    default: break\r\n    }\r\n\r\n    if (inserted) ob.observeArray(inserted)\r\n\r\n    return result\r\n  }\r\n})","export function proxy(vm, data, key) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[data][key]\r\n    },\r\n    set(newValue) {\r\n      vm[data][key] = newValue\r\n    }\r\n  })\r\n}\r\n\r\nexport function defineProperty(target, key, value) {\r\n  Object.defineProperty(target, key, {\r\n    enumerable: false,\r\n    configurable: false,\r\n    value\r\n  })\r\n}","import { arrayMethods } from './array'\r\nimport { defineProperty } from '../utils'\r\n\r\n/**\r\n * 劫持对象\r\n * @param {object} data\r\n * @param {*} key\r\n * @param {*} value\r\n */\r\nfunction defineReactive(data, key, value) {\r\n  observe(value) // 递归劫持\r\n  Object.defineProperty(data, key, {\r\n    get() {\r\n      console.log('用户获取值了')\r\n      return value\r\n    },\r\n    set(newValue) {\r\n      if (newValue == value) return\r\n      observe(newValue) // 如果新值是个对象也要拦截\r\n      value = newValue\r\n      console.log('用户设置值了')\r\n    }\r\n  })\r\n}\r\n\r\n/**\r\n * 封装对属性进行观测的类\r\n */\r\nclass Observer {\r\n  constructor(value) {\r\n    // 判断一个对象是否被观测过可以查看有没有没 __ob__\r\n    defineProperty(value, '__ob__', this)\r\n\r\n    // 使用 defineProperty 重新定义属性\r\n    if (Array.isArray(value)) { // 数组函数劫持(切片编程)\r\n      Object.setPrototypeOf(value, arrayMethods)\r\n      this.observeArray(value) // 观测数组中的对象类型\r\n    } else { // 对象属性劫持\r\n      this.walk(value)\r\n    }\r\n  }\r\n  observeArray(value) {\r\n    value.forEach(item => observe(item))\r\n  }\r\n  walk(data) {\r\n    let keys = Object.keys(data)\r\n    keys.forEach(key => {\r\n      // 定义成响应数据\r\n      defineReactive(data, key, data[key])\r\n    })\r\n  }\r\n}\r\n\r\nexport function observe(data) {\r\n  if (typeof data !== 'object' && data !== null) { // 确保必须是对象\r\n    return data\r\n  }\r\n  if (data.__ob__) {\r\n    return data\r\n  }\r\n  return new Observer(data)\r\n}","import { observe } from './observer/index'\r\nimport { proxy } from './utils'\r\n\r\nfunction initProps() {}\r\nfunction initMethods() {}\r\nfunction initData(vm) {\r\n  let data = vm.$options.data\r\n  vm._data = data = typeof data == 'function' ? data.call(vm) : data\r\n\r\n  // 将data的属性代理到vm上\r\n  for (let key in data) {\r\n    proxy(vm, '_data', key)\r\n  }\r\n\r\n  // 数据的劫持方案 Object.defineProperty 对象处理\r\n  observe(data)\r\n}\r\nfunction initComputed() {}\r\nfunction initWatch() {}\r\n\r\n/**\r\n * 初始化状态 - 数据劫持\r\n * @param {object} vm - Vue实例\r\n */\r\nexport function initState(vm) {\r\n  const opts = vm.$options\r\n  if (opts.props) {\r\n    initProps(vm)\r\n  }\r\n  if (opts.methods) {\r\n    initMethods(vm)\r\n  }\r\n  if (opts.data) {\r\n    initData(vm)\r\n  }\r\n  if (opts.computed) {\r\n    initComputed(vm)\r\n  }\r\n  if (opts.watch) {\r\n    initWatch(vm)\r\n  }\r\n}\r\n","import { initState } from './state'\r\n\r\n/**\r\n * Vue初始化功能扩展插件\r\n * @param {object} Vue - Vue构造函数\r\n */\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function (options) {\r\n    const vm = this\r\n    vm.$options = options\r\n\r\n    // 初始化状态(数据劫持，当数据改变时更新视图)\r\n    initState(vm)\r\n  }\r\n}","import { initMixin } from './init'\r\n\r\nfunction Vue(options) {\r\n  this._init(options)\r\n}\r\n\r\n// 扩展了初始化功能\r\ninitMixin(Vue)\r\n\r\nexport default Vue"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","console","log","args","result","apply","inserted","ob","__ob__","slice","observeArray","proxy","vm","data","key","defineProperty","get","set","newValue","target","value","enumerable","configurable","defineReactive","observe","Observer","isArray","setPrototypeOf","walk","item","keys","initData","$options","_data","call","initState","opts","props","computed","watch","initMixin","Vue","_init","options"],"mappings":"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"}